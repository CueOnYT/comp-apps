<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>comp-apps ‚Äî Game Hub (Pro)</title>
  <meta name="description" content="comp-apps Game Hub ‚Äî Slots, Blackjack, Math Sprint, Typing and Bug Buster. Responsive, touch-friendly, with local leaderboards." />
  <style>
    :root{
      --bg:#071026; --panel:#0f1730; --ink:#e8f0ff; --muted:#9fb0d6;
      --brand:#7cf1c8; --accent:#9bb4ff; --danger:#ff7b9c; --warn:#ffd36e; --ok:#79f28c;
      --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:radial-gradient(1400px 800px at 70% -20%, #16233f 0%, var(--bg) 60%) fixed;color:var(--ink);font:16px/1.45 Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;}
    a{color:var(--brand)}

    /* Layout */
    .wrap{max-width:1260px;margin:18px auto;padding:18px;display:grid;gap:18px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px;border-radius:14px;background:linear-gradient(180deg,var(--glass), rgba(0,0,0,.12));border:1px solid rgba(255,255,255,.04);}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:46px;height:46px;border-radius:10px;display:grid;place-items:center;background:conic-gradient(from 160deg,var(--brand),var(--accent));color:#071026;font-weight:900}
    h1{font-size:20px;margin:0}
    .sub{font-size:12px;color:var(--muted)}

    .nav{display:flex;gap:8px;flex-wrap:wrap}
    .tab{appearance:none;border:none;border-radius:10px;padding:8px 10px;font-weight:700;cursor:pointer;background:linear-gradient(180deg,#163055,#0b1b33);color:var(--ink);border:1px solid rgba(255,255,255,.04);transition:transform .12s ease, box-shadow .12s ease}
    .tab:active{transform:translateY(1px)}
    .tab[aria-current="page"]{box-shadow:0 8px 30px rgba(0,0,0,.5), 0 0 0 3px rgba(124,241,200,.06)}

    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
    @media (max-width:1080px){.grid{grid-template-columns:1fr}}

    .card{background:linear-gradient(180deg,var(--glass), rgba(0,0,0,.14));border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,.03);box-shadow:0 20px 60px rgba(0,0,0,.4)}
    .stage{min-height:480px}
    .section{display:none}
    .section.active{display:block}

    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:920px){.row{grid-template-columns:1fr}}

    button.btn{appearance:none;border:none;border-radius:10px;padding:10px 12px;font-weight:800;background:linear-gradient(180deg,#17325a,#0b1a33);color:var(--ink);cursor:pointer;border:1px solid rgba(255,255,255,.04);transition:transform .08s ease,filter .12s}
    button.btn:active{transform:translateY(1px)}
    .ghost{background:transparent;border-color:rgba(255,255,255,.06)}

    .hud{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
    .chip{padding:6px 10px;border-radius:999px;background:rgba(0,0,0,.22);border:1px solid rgba(255,255,255,.03);font-weight:700}
    .chip.warn{color:var(--warn)} .chip.good{color:var(--ok)}

    .reels{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:12px 0}
    .reel{height:120px;border-radius:12px;display:grid;place-items:center;font-size:48px;background:linear-gradient(180deg,#20345a,#0f1930);border:1px solid rgba(255,255,255,.04);transition:transform .3s cubic-bezier(.2,.9,.3,1)}
    .reel.spin{animation:spin-reel .45s linear}
    @keyframes spin-reel{0%{transform:translateY(-10px) scale(.98)}50%{transform:translateY(10px) scale(1.02)}100%{transform:none}}

    .cards{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
    .cardx{width:60px;height:86px;border-radius:10px;display:grid;place-items:center;background:linear-gradient(180deg,#f6fbff,#dfe8ff);color:#071026;font-weight:900;border:1px solid rgba(10,12,20,.06);box-shadow:0 6px 18px rgba(0,0,0,.25);transition:transform .12s ease}
    /* face-down/back of card ‚Äî clearly visible */
    .cardx.back{background:linear-gradient(180deg,#0b213f,#06112a);color:#fff;display:grid;font-weight:900;align-items:center;justify-content:center}
    .problem{font-size:26px;font-weight:800;margin:8px 0}
    input[type="number"], input[type="text"], input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.04);background:#081227;color:var(--ink)}

    .typingText{padding:12px;border-radius:12px;background:#071229;border:1px solid rgba(255,255,255,.03);min-height:96px;color:var(--ink)}
    .typingText .done{opacity:.5} .typingText .cur{outline:2px solid rgba(155,180,255,.12)} .typingText .wrong{background:#5b0f22}

    .canvasWrap{aspect-ratio:16/9;border-radius:12px;overflow:hidden;background:radial-gradient(900px 600px at 20% -10%, #0f1b3b 0%, #071229 50%, #020618 100%)}
    canvas{width:100%;height:100%;display:block}

    .fade{transition:opacity .25s ease, transform .25s ease}
    .softShadow{box-shadow:0 30px 80px rgba(2,6,18,.6)}

    .lb{margin-top:12px;border-radius:10px;padding:10px;background:linear-gradient(180deg,#071229,#041028);border:1px solid rgba(255,255,255,.03)}
    .lb h4{margin:6px 0 8px}
    .lb ol{padding-left:18px}

    @media (max-width:420px){ .reel{height:96px;font-size:36px} .cardx{width:48px;height:70px} }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">CA</div>
        <div>
          <h1>comp-apps ‚Äî <span class="sub">Game Hub</span></h1>
          <div class="sub">Quick games with local leaderboards ‚Äî play on phone, tablet or desktop.</div>
        </div>
      </div>

      <nav class="nav" role="tablist" aria-label="Games">
        <button class="tab" data-tab="slots" aria-current="page">üé∞ Slots</button>
        <button class="tab" data-tab="blackjack">üÇ° Blackjack</button>
        <button class="tab" data-tab="math">‚ûó Math Sprint</button>
        <button class="tab" data-tab="typing">‚å®Ô∏è Typing</button>
        <button class="tab" data-tab="arcade">üïπÔ∏è Bug Buster</button>
      </nav>
    </header>

    <div class="grid">
      <main class="card stage">
        <!-- SLOTS -->
        <section id="sec-slots" class="section active" role="tabpanel">
          <h2>Lucky Slots</h2>
          <p class="sub">Spin for points. Hold the plus/minus to change bet faster ‚Äî it speeds up the longer you hold.</p>
          <div class="hud">
            <div class="chip">Balance: <strong id="slotsBal">100</strong></div>
            <div class="chip">Bet: <strong id="slotsBet">5</strong></div>
            <div class="chip">Best: <strong id="slotsBest">0</strong></div>
            <div class="chip" id="slotsMsg"> </div>
          </div>

          <div class="row">
            <div>
              <div class="reels">
                <div class="reel" id="reel1">üçí</div>
                <div class="reel" id="reel2">üçã</div>
                <div class="reel" id="reel3">‚≠ê</div>
              </div>

              <div style="display:flex; gap:8px; align-items:center">
                <button class="btn" id="spinBtn">Spin</button>
                <button class="btn" id="betDown" data-dir="-">Bet ‚àí</button>
                <button class="btn" id="betUp" data-dir="+">Bet +</button>
                <button class="btn ghost" id="resetSlots">Reset</button>
              </div>

              <div class="lb" id="slotsLeaderboard">
                <h4>Slots Leaderboard</h4>
                <ol id="lb-slots"> </ol>
                <div style="display:flex;gap:8px;margin-top:8px">
                  <input id="lb-slots-name" placeholder="Your name" />
                  <button class="btn" id="lb-slots-save">Save Balance</button>
                </div>
              </div>
            </div>

            <div>
              <h3>Payouts</h3>
              <ul class="sub">
                <li>3√ó ‚≠ê = 20√ó bet</li>
                <li>3√ó üçí = 12√ó bet</li>
                <li>3√ó üçã = 8√ó bet</li>
                <li>Any 2 match = 3√ó bet</li>
              </ul>
              <p class="sub">Your best balance is stored on this device. Add your name to save to the leaderboard.</p>
            </div>
          </div>
        </section>

        <!-- BLACKJACK -->
        <section id="sec-blackjack" class="section" role="tabpanel" aria-hidden="true">
          <h2>Blackjack</h2>
          <p class="sub">Aim for 21. Aces switch between 1 and 11 automatically. Dealer stands on 17+</p>
          <div class="hud">
            <div class="chip">Bank: <strong id="bjBank">100</strong></div>
            <div class="chip">Bet: <strong id="bjBet">10</strong></div>
            <div class="chip">Best: <strong id="bjBest">0</strong></div>
            <div class="chip" id="bjMsg"> </div>
          </div>

          <div class="row">
            <div>
              <h3>Dealer <span class="muted">(<span id="dVal">?</span>)</span></h3>
              <div class="cards" id="dealer"></div>
              <h3>You <span class="muted">(<span id="pVal">0</span>)</span></h3>
              <div class="cards" id="player"></div>

              <div style="display:flex; gap:8px; margin-top:8px">
                <button class="btn" id="bjDeal">Deal</button>
                <button class="btn" id="bjHit" disabled>Hit</button>
                <button class="btn" id="bjStand" disabled>Stand</button>
                <button class="btn ghost" id="bjBetDown" data-dir="-">Bet ‚àí</button>
                <button class="btn ghost" id="bjBetUp" data-dir="+">Bet +</button>
                <button class="btn ghost" id="bjReset">Reset Bank</button>
              </div>

              <div class="lb" id="bjLeaderboard">
                <h4>Blackjack Leaderboard</h4>
                <ol id="lb-bj"> </ol>
                <div style="display:flex;gap:8px;margin-top:8px">
                  <input id="lb-bj-name" placeholder="Your name" />
                  <button class="btn" id="lb-bj-save">Save Bank</button>
                </div>
              </div>
            </div>

            <div>
              <h3>Quick Notes</h3>
              <ul class="sub">
                <li>Ace counts as 1 or 11, whichever helps your hand.</li>
                <li>Blackjack (Ace + 10-value) pays 3:2 on the initial deal.</li>
                <li>You can see your current total and dealer's total when cards are revealed.</li>
              </ul>
            </div>
          </div>
        </section>

        <!-- MATH -->
        <section id="sec-math" class="section" role="tabpanel" aria-hidden="true">
          <h2>Math Sprint</h2>
          <p class="sub">60 seconds ‚Äî quick problems. Keep a streak going to earn bonus points.</p>
          <div class="hud">
            <div class="chip">Score: <strong id="mathScore">0</strong></div>
            <div class="chip">Streak: <strong id="mathStreak">0</strong></div>
            <div class="chip warn">Time: <strong id="mathTime">60</strong>s</div>
            <div class="chip">Best: <strong id="mathBest">0</strong></div>
          </div>

          <div class="row">
            <div>
              <div class="problem" id="mathQ">3 + 4 = ?</div>
              <div style="display:flex; gap:8px; margin-top:8px">
                <input type="number" id="mathA" placeholder="Answer" />
                <button class="btn" id="mathSubmit">Submit</button>
                <button class="btn" id="mathStart">Start</button>
                <button class="btn ghost" id="mathReset">Reset Best</button>
              </div>
              <p class="muted" id="mathMsg"> </p>
            </div>

            <div>
              <h3>Operations</h3>
              <label><input type="checkbox" id="opAdd" checked/> Add</label><br/>
              <label><input type="checkbox" id="opSub" checked/> Subtract</label><br/>
              <label><input type="checkbox" id="opMul" checked/> Multiply</label><br/>
              <label><input type="checkbox" id="opDiv"/> Divide</label>

              <div class="lb" id="mathLeaderboard">
                <h4>Math Leaderboard</h4>
                <ol id="lb-math"> </ol>
                <div style="display:flex;gap:8px;margin-top:8px">
                  <input id="lb-math-name" placeholder="Your name" />
                  <button class="btn" id="lb-math-save">Save Score</button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- TYPING -->
        <section id="sec-typing" class="section" role="tabpanel" aria-hidden="true">
          <h2>Typing Test</h2>
          <p class="sub">30 seconds ‚Äî steady, accurate typing wins. Save your best WPM to the leaderboard.</p>
          <div class="hud">
            <div class="chip">WPM: <strong id="typeWpm">0</strong></div>
            <div class="chip">Accuracy: <strong id="typeAcc">100%</strong></div>
            <div class="chip warn">Time: <strong id="typeTime">30</strong>s</div>
            <div class="chip">Best: <strong id="typeBest">0</strong></div>
          </div>

          <div class="typingText" id="typingText" aria-live="polite"></div>
          <div style="display:flex; gap:8px; margin-top:8px">
            <input type="text" id="typeInput" placeholder="Tap Start then type here" />
            <button class="btn" id="typeStart">Start</button>
            <button class="btn ghost" id="typeReset">Reset Best</button>
          </div>

          <div class="lb" id="typeLeaderboard">
            <h4>Typing Leaderboard</h4>
            <ol id="lb-type"> </ol>
            <div style="display:flex;gap:8px;margin-top:8px">
              <input id="lb-type-name" placeholder="Your name" />
              <button class="btn" id="lb-type-save">Save WPM</button>
            </div>
          </div>
        </section>

        <!-- ARCADE -->
        <section id="sec-arcade" class="section" role="tabpanel" aria-hidden="true">
          <h2>Bug Buster</h2>
          <p class="sub">Collect files, avoid bugs, and rack up points. Touch controls included for mobile.</p>
          <div class="hud">
            <div class="chip" id="scoreChip">Score: 0</div>
            <div class="chip" id="levelChip">Level: 1</div>
            <div class="chip" id="filesChip">Files: 0</div>
            <div class="chip">Lives: <strong id="livesChip">3</strong></div>
            <div class="chip">Best: <strong id="bestChip">0</strong></div>
          </div>

          <div class="canvasWrap card" style="padding:0">
            <canvas id="game" width="960" height="540" role="img" aria-label="Arcade game canvas"></canvas>
          </div>

          <div style="display:flex; gap:8px; margin-top:10px; flex-wrap:wrap">
            <button class="btn" id="startBtn">‚ñ∂ Start</button>
            <button class="btn" id="pauseBtn">‚è∏Ô∏é Pause</button>
            <button class="btn ghost" id="resetBtn">‚Ü∫ Reset Best</button>
          </div>

          <div class="lb" id="arcLeaderboard">
            <h4>Arcade Leaderboard</h4>
            <ol id="lb-arc"> </ol>
            <div style="display:flex;gap:8px;margin-top:8px">
              <input id="lb-arc-name" placeholder="Your name" />
              <button class="btn" id="lb-arc-save">Save Score</button>
            </div>
          </div>
        </section>
      </main>

      <aside class="card">
        <h3>Leaderboards & Stats</h3>
        <p class="muted">Top scores are saved on this device only. After a run, type your name and press Save to add your score.</p>
        <div style="margin-top:12px">
          <button class="btn" id="clearAll">Clear all saved data</button>
        </div>
        <div style="margin-top:12px" id="quickLB">
          <h4>Quick Top Scores</h4>
          <div class="lb">
            <strong>Slots:</strong> <span id="quick-slots">‚Äî</span><br/>
            <strong>Blackjack:</strong> <span id="quick-bj">‚Äî</span><br/>
            <strong>Math:</strong> <span id="quick-math">‚Äî</span><br/>
            <strong>Typing:</strong> <span id="quick-type">‚Äî</span><br/>
            <strong>Arcade:</strong> <span id="quick-arc">‚Äî</span>
          </div>
        </div>
      </aside>
    </div>

    <footer class="muted">comp-apps ‚Äî Game Hub ¬∑ Single-file ¬∑ Works on iPhone / iPad / Computer</footer>
  </div>

  <script>
    /* Small helpers */
    const qs = s=>document.querySelector(s);
    const qsa = s=>Array.from(document.querySelectorAll(s));
    const irnd = (a,b)=> Math.floor(Math.random()*(b-a+1))+a;
    const rnd = (a,b)=> Math.random()*(b-a)+a;
    const clamp = (v,a,b)=> Math.max(a, Math.min(b, v));

    /* Tabs */
    qsa('.tab').forEach(btn=> btn.addEventListener('click', ()=>{
      qsa('.tab').forEach(b=>b.removeAttribute('aria-current'));
      btn.setAttribute('aria-current','page');
      const t = btn.dataset.tab;
      qsa('.section').forEach(s=> s.classList.toggle('active', s.id === 'sec-'+t));
    }));

    /* Leaderboard helpers (localStorage) */
    function lbKey(mode){ return `lb_${mode}`; }
    function getLB(mode){ return JSON.parse(localStorage.getItem(lbKey(mode))||'[]'); }
    function saveLB(mode, name, score){
      const arr = getLB(mode);
      arr.push({name: name || 'Player', score: Number(score), t: Date.now()});
      arr.sort((a,b)=>b.score-a.score);
      arr.splice(5); // keep top 5
      localStorage.setItem(lbKey(mode), JSON.stringify(arr));
      renderLB(mode);
      updateQuick();
    }
    function renderLB(mode){
      const list = getLB(mode);
      const el = qs('#lb-'+mode);
      if(!el) return;
      el.innerHTML = list.map(i=>`<li>${i.name} ‚Äî ${i.score}</li>`).join('') || '<li>‚Äî no scores yet</li>';
    }
    function updateQuick(){
      const map = { 'slots':'quick-slots','bj':'quick-bj','math':'quick-math','type':'quick-type','arc':'quick-arc' };
      Object.keys(map).forEach(k=>{
        const arr = getLB(k);
        qs('#'+map[k]).textContent = arr[0]? `${arr[0].name} ${arr[0].score}` : '‚Äî';
      });
    }
    ['slots','bj','math','type','arc'].forEach(renderLB);
    updateQuick();

    /* ========== SLOTS ========== */
    (function(){
      const symbols = ['üçí','üçã','‚≠ê','üîî','üçá'];
      const reelEls = [qs('#reel1'), qs('#reel2'), qs('#reel3')];
      const elBal = qs('#slotsBal'), elBet = qs('#slotsBet'), elBest = qs('#slotsBest'), elMsg = qs('#slotsMsg');

      let state = {
        bal: Number(localStorage.getItem('slots_bal')||100),
        bet: Number(localStorage.getItem('slots_bet')||5),
        best: Number(localStorage.getItem('slots_best')||0)
      };
      let spinning = false;

      function save(){ localStorage.setItem('slots_bal', state.bal); localStorage.setItem('slots_bet', state.bet); state.best = Math.max(state.best, state.bal); localStorage.setItem('slots_best', state.best); render(); }
      function render(){ elBal.textContent = state.bal; elBet.textContent = state.bet; elBest.textContent = state.best; }

      async function spin(){
        if(spinning) return;
        if(state.bet < 1){ elMsg.textContent='Please set a bet of at least 1'; return; }
        if(state.bet > state.bal){ elMsg.textContent='Not enough balance'; return; }
        spinning = true; elMsg.textContent = 'Spinning‚Ä¶';
        state.bal -= state.bet; render();
        const res = [symbols[irnd(0,symbols.length-1)], symbols[irnd(0,symbols.length-1)], symbols[irnd(0,symbols.length-1)]];
        for(let i=0;i<3;i++){
          const el = reelEls[i];
          el.classList.add('spin');
          for(let f=0; f<8; f++){ el.textContent = symbols[irnd(0,symbols.length-1)]; await new Promise(r=>setTimeout(r, 45)); }
          el.textContent = res[i]; el.classList.remove('spin');
        }
        let award = 0; const set = new Set(res);
        if(set.size===1){ const s=res[0]; award = (s==='‚≠ê'?20:(s==='üçí'?12:(s==='üçã'?8:6))) * state.bet; elMsg.textContent = `Triple ${s}! +${award}`; }
        else if(set.size===2){ award = 3*state.bet; elMsg.textContent = `Pair! +${award}`; }
        else { elMsg.textContent = 'No match'; }
        state.bal = clamp(state.bal + award, 0, 999999);
        state.best = Math.max(state.best, state.bal);
        save();
        spinning = false;
      }

      qs('#spinBtn').addEventListener('click', spin);

      // hold-to-change with acceleration
      function holdAdjust(btn, dir){
        let iv = null, step = 1, accel = 0;
        const change = ()=>{
          state.bet = clamp(state.bet + dir*step, 1, 9999);
          localStorage.setItem('slots_bet', state.bet);
          render();
          accel++;
          if(accel % 8 === 0) step = Math.min(100, step*2);
        };
        btn.addEventListener('mousedown', e=>{ e.preventDefault(); change(); iv = setInterval(change, 140); });
        btn.addEventListener('mouseup', ()=>{ clearInterval(iv); iv=null; step=1; accel=0; });
        btn.addEventListener('mouseleave', ()=>{ clearInterval(iv); iv=null; step=1; accel=0; });
        btn.addEventListener('touchstart', e=>{ e.preventDefault(); change(); iv = setInterval(change, 140); }, {passive:false});
        btn.addEventListener('touchend', ()=>{ clearInterval(iv); iv=null; step=1; accel=0; });
      }
      holdAdjust(qs('#betUp'), +1);
      holdAdjust(qs('#betDown'), -1);

      qs('#resetSlots').addEventListener('click', ()=>{ state.bal=100; state.bet=5; save(); elMsg.textContent='Balance reset'; });

      // Save leaderboard
      qs('#lb-slots-save').addEventListener('click', ()=>{ const name = qs('#lb-slots-name').value.trim() || 'Player'; saveLB('slots', name, state.bal); renderLB('slots'); updateQuick(); });

      render();
      renderLB('slots');
      updateQuick();
    })();

    /* ========== BLACKJACK ========== */
    (function(){
      const suits=['‚ô†','‚ô•','‚ô¶','‚ô£']; const ranks=['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
      const dealerEl = qs('#dealer'), playerEl = qs('#player');
      const bankEl = qs('#bjBank'), betEl = qs('#bjBet'), bestEl = qs('#bjBest'), msgEl = qs('#bjMsg');
      const pValEl = qs('#pVal'), dValEl = qs('#dVal');

      let state = {
        bank: Number(localStorage.getItem('bj_bank')||100),
        bet: Number(localStorage.getItem('bj_bet')||10),
        best: Number(localStorage.getItem('bj_best')||0),
        deck: [], player: [], dealer: [], inRound: false
      };

      function save(){ localStorage.setItem('bj_bank', state.bank); localStorage.setItem('bj_bet', state.bet); state.best = Math.max(state.best, state.bank); localStorage.setItem('bj_best', state.best); renderTop(); }
      function renderTop(){ bankEl.textContent = state.bank; betEl.textContent = state.bet; bestEl.textContent = state.best; }
      function buildDeck(){ state.deck=[]; suits.forEach(s=>ranks.forEach(r=>state.deck.push(r+s))); for(let i=state.deck.length-1;i>0;i--){ const j=irnd(0,i); [state.deck[i],state.deck[j]]=[state.deck[j],state.deck[i]]; } }
      function handValue(hand){ let total=0, aces=0; for(const c of hand){ const r=c.slice(0,-1); if(['J','Q','K'].includes(r)) total+=10; else if(r==='A'){ total+=11; aces++; } else total+=Number(r); } while(total>21 && aces){ total-=10; aces--; } return total; }

      function renderHand(el, hand, hide=false){
        el.innerHTML='';
        hand.forEach((c,i)=>{
          const d=document.createElement('div');
          d.className='cardx';
          if(hide && i===0){
            d.classList.add('back'); d.textContent = 'üÇ†';
          } else {
            d.textContent=c;
          }
          el.appendChild(d);
        });
      }

      function updateVals(revealDealer=false){
        pValEl.textContent = handValue(state.player);
        dValEl.textContent = revealDealer ? handValue(state.dealer) : (state.dealer.length ? '?' : '?');
      }

      function resetRound(){
        state.player=[]; state.dealer=[]; state.inRound=false;
        renderHand(playerEl, state.player, false); renderHand(dealerEl, state.dealer, false); updateVals();
        qs('#bjHit').disabled=true; qs('#bjStand').disabled=true;
      }

      function checkNatural(){
        const pv=handValue(state.player), dv=handValue(state.dealer);
        const pBJ = (state.player.length===2 && pv===21);
        const dBJ = (state.dealer.length===2 && dv===21);
        if(pBJ || dBJ){
          renderHand(dealerEl, state.dealer, false);
          updateVals(true);
          if(pBJ && !dBJ){ const win = Math.round(state.bet*2.5); state.bank += win; msgEl.textContent = 'Blackjack! +' + (win-state.bet); }
          else if(dBJ && !pBJ){ msgEl.textContent = 'Dealer Blackjack'; }
          else { state.bank += state.bet; msgEl.textContent = 'Both blackjack ‚Äî push'; }
          state.inRound=false; qs('#bjHit').disabled=true; qs('#bjStand').disabled=true; save();
          return true;
        }
        return false;
      }

      function deal(){
        if(state.inRound) return;
        if(state.bet < 1){ msgEl.textContent='Please set a bet first'; return; }
        if(state.bet > state.bank){ msgEl.textContent='Not enough money in bank'; return; }
        buildDeck(); resetRound(); state.bank -= state.bet; save(); msgEl.textContent='Dealing...'; state.inRound=true;
        state.player.push(state.deck.pop(), state.deck.pop());
        state.dealer.push(state.deck.pop(), state.deck.pop());
        renderHand(playerEl, state.player, false);
        renderHand(dealerEl, state.dealer, true);
        updateVals(false);
        setTimeout(()=>{ if(!checkNatural()){ qs('#bjHit').disabled=false; qs('#bjStand').disabled=false; } }, 250);
      }

      function dealerPlay(){
        renderHand(dealerEl, state.dealer, false); updateVals(true);
        while(handValue(state.dealer) < 17){
          state.dealer.push(state.deck.pop());
          renderHand(dealerEl, state.dealer, false);
          updateVals(true);
        }
        const pv = handValue(state.player), dv = handValue(state.dealer);
        let win=0, txt='';
        if(dv>21 || pv>dv){ win = state.bet*2; txt = 'You win! +' + (win-state.bet); }
        else if(pv === dv){ win = state.bet; txt = 'Push'; }
        else { win=0; txt = 'Dealer wins'; }
        state.bank += win; msgEl.textContent = txt; state.inRound=false; qs('#bjHit').disabled=true; qs('#bjStand').disabled=true; save();
      }

      qs('#bjDeal').addEventListener('click', deal);
      qs('#bjHit').addEventListener('click', ()=> {
        if(!state.inRound) return;
        state.player.push(state.deck.pop());
        renderHand(playerEl, state.player, false);
        updateVals(false);
        if(handValue(state.player) > 21){
          renderHand(dealerEl, state.dealer, false);
          updateVals(true);
          msgEl.textContent = 'Bust!';
          state.inRound=false; qs('#bjHit').disabled=true; qs('#bjStand').disabled=true; save();
        }
      });
      qs('#bjStand').addEventListener('click', ()=>{ if(!state.inRound) return; dealerPlay(); });

      // hold-to-change bet with acceleration (like slots)
      function holdAdjust(btn, dir){
        let iv=null, step=1, accel=0;
        const change = ()=>{
          state.bet = clamp(state.bet + dir*step, 1, 9999);
          betEl.textContent = state.bet;
          localStorage.setItem('bj_bet', state.bet);
          accel++;
          if(accel % 8 === 0) step = Math.min(100, step*2);
        };
        btn.addEventListener('mousedown', e=>{ e.preventDefault(); change(); iv = setInterval(change, 140); });
        btn.addEventListener('mouseup', ()=>{ clearInterval(iv); iv=null; step=1; accel=0; });
        btn.addEventListener('mouseleave', ()=>{ clearInterval(iv); iv=null; step=1; accel=0; });
        btn.addEventListener('touchstart', e=>{ e.preventDefault(); change(); iv = setInterval(change, 140); }, {passive:false});
        btn.addEventListener('touchend', ()=>{ clearInterval(iv); iv=null; step=1; accel=0; });
      }
      holdAdjust(qs('#bjBetUp'), +1);
      holdAdjust(qs('#bjBetDown'), -1);

      qs('#bjReset').addEventListener('click', ()=>{ if(state.inRound) return; state.bank=100; state.bet=10; save(); msgEl.textContent='Bank reset'; });

      // Save bank to leaderboard
      qs('#lb-bj-save').addEventListener('click', ()=>{ const name = qs('#lb-bj-name').value.trim() || 'Player'; saveLB('bj', name, state.bank); renderLB('bj'); updateQuick(); });

      renderTop();
      renderLB('bj');
    })();

    /* ========== MATH SPRINT ========== */
    (function(){
      const mq = qs('#mathQ'), ma = qs('#mathA'), scoreEl = qs('#mathScore'), streakEl = qs('#mathStreak'), timeEl = qs('#mathTime'), bestEl = qs('#mathBest'), msgEl = qs('#mathMsg');
      const opAdd = qs('#opAdd'), opSub = qs('#opSub'), opMul = qs('#opMul'), opDiv = qs('#opDiv');

      let state = { score:0, streak:0, time:60, timer:0, best:Number(localStorage.getItem('math_best')||0), running:false };

      function nextQ(){
        const ops=[];
        if(opAdd.checked) ops.push('+');
        if(opSub.checked) ops.push('-');
        if(opMul.checked) ops.push('*');
        if(opDiv.checked) ops.push('/');
        if(ops.length === 0) ops.push('+');
        const op = ops[irnd(0, ops.length-1)];
        let a=irnd(1,12), b=irnd(1,12), text='', ans=0;
        if(op === '/'){ ans = irnd(1,12); b = irnd(1,12); a = ans * b; text = `${a} √∑ ${b} = ?`; }
        else if(op === '*'){ ans = a*b; text = `${a} √ó ${b} = ?`; }
        else if(op === '+'){ ans = a+b; text = `${a} + ${b} = ?`; }
        else { ans = a-b; text = `${a} ‚àí ${b} = ?`; }
        mq.dataset.ans = ans; mq.textContent = text; ma.value = ''; ma.focus();
      }

      function tick(){
        state.time--; timeEl.textContent = state.time;
        if(state.time <= 0){
          clearInterval(state.timer); state.timer = 0; state.running = false;
          msgEl.textContent = `Time's up ‚Äî final ${state.score}`;
          state.best = Math.max(state.best, state.score);
          localStorage.setItem('math_best', state.best);
          bestEl.textContent = state.best;
          renderLB('math'); updateQuick();
        }
        if(state.time === 10) timeEl.parentElement.classList.add('danger');
      }

      qs('#mathStart').addEventListener('click', ()=>{
        if(state.running) return;
        state.running = true; state.score=0; state.streak=0; state.time=60;
        scoreEl.textContent = 0; streakEl.textContent=0; timeEl.textContent = 60; msgEl.textContent='';
        nextQ();
        if(state.timer) clearInterval(state.timer);
        state.timer = setInterval(tick, 1000);
      });

      qs('#mathSubmit').addEventListener('click', ()=>{
        if(!state.running){ msgEl.textContent='Press Start'; return; }
        const val = Number(ma.value); const ans = Number(mq.dataset.ans);
        if(val === ans){ state.streak++; const gain = 10 + Math.floor(Math.max(0, state.streak-1)*2); state.score += gain; msgEl.textContent = `Nice! +${gain}`; }
        else { state.streak = 0; msgEl.textContent = `Not quite ‚Äî answer ${ans}`; }
        scoreEl.textContent = state.score; streakEl.textContent = state.streak;
        nextQ();
      });

      ma.addEventListener('keydown', e=>{ if(e.key === 'Enter'){ e.preventDefault(); qs('#mathSubmit').click(); } });
      qs('#mathReset').addEventListener('click', ()=>{ localStorage.removeItem('math_best'); state.best=0; bestEl.textContent=0; renderLB('math'); updateQuick(); });
      qs('#lb-math-save').addEventListener('click', ()=>{ const name = qs('#lb-math-name').value.trim() || 'Player'; saveLB('math', name, state.score); renderLB('math'); updateQuick(); });
      bestEl.textContent = state.best;
    })();

    /* ========== TYPING TEST ========== */
    (function(){
      const samples=[ 'Practice makes progress. Keep your fingers light and your thoughts steady.', 'Computers follow instructions exactly. Clear code is the best gift to future you.', 'Small habits repeated daily build big skills over time.', 'Stay calm, type steady, and let accuracy lead your speed.' ];
      const wrap = qs('#typingText'), input = qs('#typeInput'), wpmEl = qs('#typeWpm'), accEl = qs('#typeAcc'), timeEl = qs('#typeTime'), bestEl = qs('#typeBest'), msgEl = qs('#typeMsg');
      let state = { text:'', idx:0, time:30, timer:0, correct:0, typed:0, best:Number(localStorage.getItem('type_best')||0), running:false };

      function pick(){ state.text = samples[irnd(0, samples.length-1)]; state.idx=0; render(); }
      function render(){ const before = state.text.slice(0,state.idx); const cur = state.text[state.idx]||''; const after=state.text.slice(state.idx+1); wrap.innerHTML = `<span class="done">${escapeHtml(before)}</span><span class="cur">${escapeHtml(cur)}</span>${escapeHtml(after)}`; }
      function escapeHtml(s){ return s.replace(/[&<>]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[c])); }

      function tick(){
        state.time--; timeEl.textContent = state.time;
        const elapsed = Math.max(1, 30 - state.time);
        const wpm = Math.round((state.typed/5) * (60/elapsed));
        const acc = state.typed ? Math.round((state.correct/state.typed)*100) : 100;
        wpmEl.textContent = wpm; accEl.textContent = acc + '%';
        if(state.time <= 0){
          clearInterval(state.timer); state.timer=0; state.running=false;
          msgEl.textContent = `Done ‚Äî WPM ${wpm}, Acc ${acc}%`;
          state.best = Math.max(state.best, wpm);
          localStorage.setItem('type_best', state.best);
          bestEl.textContent = state.best;
          renderLB('type'); updateQuick();
        }
      }

      qs('#typeStart').addEventListener('click', ()=>{
        if(state.running) return;
        state.running = true; state.time=30; state.correct=0; state.typed=0; state.idx=0;
        wpmEl.textContent=0; accEl.textContent='100%'; msgEl.textContent='';
        pick(); input.value=''; input.focus();
        if(state.timer) clearInterval(state.timer);
        state.timer = setInterval(tick, 1000);
      });

      input.addEventListener('input', ()=>{
        if(!state.running){ msgEl.textContent='Press Start'; input.value=''; return; }
        const ch = input.value.slice(-1); input.value=''; state.typed++;
        if(ch === state.text[state.idx]){ state.correct++; state.idx++; render(); if(state.idx >= state.text.length) pick(); }
        else { const curEl = wrap.querySelector('.cur'); if(curEl){ curEl.classList.add('wrong'); setTimeout(()=>curEl.classList.remove('wrong'),120); } }
      });

      qs('#typeReset').addEventListener('click', ()=>{ localStorage.removeItem('type_best'); state.best=0; bestEl.textContent=0; renderLB('type'); updateQuick(); });
      qs('#lb-type-save').addEventListener('click', ()=>{ const name = qs('#lb-type-name').value.trim() || 'Player'; const wpm = Number(wpmEl.textContent)||0; saveLB('type', name, wpm); renderLB('type'); updateQuick(); });
      bestEl.textContent = state.best;
    })();

    /* ========== ARCADE (Bug Buster) ========== */
    (function(){
      const CONFIG = { startLives:3, maxLives:5, baseSpeed:2.2, playerSpeed:3.6, fileWorth:10, spawnBugEvery:1200, spawnFileEvery:950, spawnPowerEvery:6000, slowMoFactor:0.45, slowMoDuration:5000, levelTime:60, levelSpeedBoost:0.35 };
      const canvas = qs('#game'); const g = canvas.getContext('2d'); let dpr = Math.max(1, Math.min(2, window.devicePixelRatio||1));
      function resize(){ const r = canvas.getBoundingClientRect(); canvas.width = Math.round(r.width * dpr); canvas.height = Math.round(r.height * dpr); }
      new ResizeObserver(resize).observe(canvas); resize();

      const state = { running:false, paused:false, over:false, level:1, score:0, files:0, lives:CONFIG.startLives, tStart:0, tNow:0, tSlowEnd:0, nextBug:0, nextFile:0, nextPower:0, player:{x:200,y:200,r:12*dpr,vx:0,vy:0}, bugs:[], filesArr:[], powers:[], best:Number(localStorage.getItem('bb_best')||0) };

      function circle(x,y,r,c){ g.beginPath(); g.arc(x,y,r,0,Math.PI*2); g.fillStyle=c; g.fill(); }
      function square(x,y,s,c){ g.fillStyle=c; g.fillRect(x-s/2,y-s/2,s,s); }
      function tri(x,y,s,c){ g.beginPath(); g.moveTo(x, y-s/1.2); g.lineTo(x-s/1.4, y+s/1.8); g.lineTo(x+s/1.4, y+s/1.8); g.closePath(); g.fillStyle=c; g.fill(); }
      function label(t,x,y,s=12){ g.font = `${s*dpr}px system-ui, sans-serif`; g.fillStyle='rgba(232,240,255,.95)'; g.textAlign='center'; g.fillText(t,x,y); }

      const keys = new Set();
      window.addEventListener('keydown', e=>{ if(['arrowup','arrowdown','arrowleft','arrowright','w','a','s','d'].includes(e.key.toLowerCase())){ keys.add(e.key.toLowerCase()); e.preventDefault(); } if(e.key==='p'||e.key==='P') togglePause(); if(e.key==='r'||e.key==='R') start(); });
      window.addEventListener('keyup', e=> keys.delete(e.key.toLowerCase()));

      let touchVec = { x:0, y:0 };

      function spawnBug(){ const speed=(CONFIG.baseSpeed + (state.level-1)*CONFIG.levelSpeedBoost)*dpr*rnd(.8,1.15); const edge=Math.random()<.5?'x':'y'; let x,y; if(edge==='x'){ x=Math.random()<.5? -30: canvas.width+30; y=rnd(0,canvas.height); } else { y=Math.random()<.5? -30: canvas.height+30; x=rnd(0,canvas.width); } const ang=Math.atan2(state.player.y - y, state.player.x - x); state.bugs.push({ x,y,s:16*dpr, vx:Math.cos(ang)*speed, vy:Math.sin(ang)*speed }); }
      function spawnFile(){ state.filesArr.push({ x:rnd(40,canvas.width-40), y:rnd(40,canvas.height-40), s:14*dpr }); }
      function spawnPower(){ const kind = Math.random()<0.7?'slow':'life'; state.powers.push({ kind, x:rnd(40,canvas.width-40), y:rnd(40,canvas.height-40), s:12*dpr, t:performance.now()+7000 }); }

      function start(){ state.running=true; state.paused=false; state.over=false; state.level=1; state.score=0; state.files=0; state.lives=CONFIG.startLives; state.bugs.length=0; state.filesArr.length=0; state.powers.length=0; state.tStart=performance.now(); state.tNow=state.tStart; state.tSlowEnd=0; state.nextBug=0; state.nextFile=0; state.nextPower=0; const r=canvas.getBoundingClientRect(); state.player.x=(r.width*0.5)*dpr; state.player.y=(r.height*0.6)*dpr; loop(); }
      function togglePause(){ if(!state.running || state.over) return; state.paused = !state.paused; if(!state.paused) loop(); }
      function endGame(){ state.over=true; state.running=false; state.best = Math.max(state.best, state.score); localStorage.setItem('bb_best', state.best); renderLB('arc'); updateQuick(); qs('#bestChip').textContent=state.best; }

      function loop(){
        if(!state.running || state.paused) return;
        requestAnimationFrame(loop);
        const now = performance.now();
        const dtRaw = Math.min(32, now - state.tNow);
        const dt = dtRaw * (now < state.tSlowEnd ? CONFIG.slowMoFactor : 1);
        state.tNow = now;
        const elapsed = Math.floor((now - state.tStart)/1000);
        if(elapsed>0 && elapsed % CONFIG.levelTime === 0) state.level++;

        if(now > state.nextBug){ spawnBug(); state.nextBug = now + Math.max(300, CONFIG.spawnBugEvery - state.level*60); }
        if(now > state.nextFile){ spawnFile(); state.nextFile = now + CONFIG.spawnFileEvery; }
        if(now > state.nextPower){ spawnPower(); state.nextPower = now + CONFIG.spawnPowerEvery; }

        const ps = CONFIG.playerSpeed * dpr;
        const ax = (keys.has('arrowleft')||keys.has('a')?-1:0) + (keys.has('arrowright')||keys.has('d')?1:0) + touchVec.x;
        const ay = (keys.has('arrowup')||keys.has('w')?-1:0) + (keys.has('arrowdown')||keys.has('s')?1:0) + touchVec.y;
        state.player.vx = ax * ps * (dt/16);
        state.player.vy = ay * ps * (dt/16);
        state.player.x = clamp(state.player.x + state.player.vx, 12*dpr, canvas.width - 12*dpr);
        state.player.y = clamp(state.player.y + state.player.vy, 12*dpr, canvas.height - 12*dpr);

        const speedMult = now < state.tSlowEnd ? 0.4 : 1;
        state.bugs.forEach(b=>{ b.x += b.vx * (dt/16) * speedMult; b.y += b.vy * (dt/16) * speedMult; });
        state.bugs = state.bugs.filter(b=> b.x > -60 && b.x < canvas.width + 60 && b.y > -60 && b.y < canvas.height + 60);

        state.filesArr = state.filesArr.filter(f=>{ const hit = Math.hypot(state.player.x - f.x, state.player.y - f.y) < (state.player.r + f.s*0.7); if(hit){ state.score += CONFIG.fileWorth; state.files++; } return !hit; });
        state.powers = state.powers.filter(p=>{ const expired = now > p.t; if(expired) return false; const hit = Math.hypot(state.player.x - p.x, state.player.y - p.y) < (state.player.r + p.s*0.7); if(hit){ if(p.kind==='slow'){ state.tSlowEnd = now + CONFIG.slowMoDuration; } else if(state.lives < CONFIG.maxLives){ state.lives++; } } return !hit; });

        for(let i=state.bugs.length-1;i>=0;i--){ const b = state.bugs[i]; if(Math.hypot(state.player.x - b.x, state.player.y - b.y) < (state.player.r + b.s*0.5)){ state.bugs.splice(i,1); state.lives--; if(state.lives<=0){ endGame(); break; } } }

        // draw
        g.clearRect(0,0,canvas.width,canvas.height);
        g.globalAlpha = 0.06; g.strokeStyle = '#7cf1c833'; g.lineWidth = 1 * dpr; const step = 48 * dpr;
        for(let x=step;x<canvas.width;x+=step){ g.beginPath(); g.moveTo(x,0); g.lineTo(x,canvas.height); g.stroke(); }
        for(let y=step;y<canvas.height;y+=step){ g.beginPath(); g.moveTo(0,y); g.lineTo(canvas.width,y); g.stroke(); }
        g.globalAlpha = 1;

        state.filesArr.forEach(f=> square(f.x, f.y, f.s, '#9bb4ff'));
        state.powers.forEach(p=>{ if(p.kind==='slow'){ circle(p.x,p.y,10*dpr,'#7cf1c8'); label('‚òÖ', p.x, p.y + 4*dpr, 14); } else { circle(p.x,p.y,10*dpr,'#79f28c'); label('‚ù§', p.x, p.y + 5*dpr, 14); } });
        state.bugs.forEach(b=> tri(b.x,b.y,b.s,'#ff7b9c'));
        circle(state.player.x, state.player.y, state.player.r, '#e8f0ff');

        qs('#scoreChip').textContent = 'Score: ' + state.score;
        qs('#levelChip').textContent = 'Level: ' + state.level;
        qs('#filesChip').textContent = 'Files: ' + state.files;
        qs('#livesChip').textContent = state.lives;
        qs('#bestChip').textContent = state.best;
      }

      qs('#startBtn').addEventListener('click', ()=> start());
      qs('#pauseBtn').addEventListener('click', ()=> togglePause());
      qs('#resetBtn').addEventListener('click', ()=>{ localStorage.removeItem('bb_best'); state.best=0; qs('#bestChip').textContent=0; renderLB('arc'); updateQuick(); });

      qs('#lb-arc-save').addEventListener('click', ()=>{ const name = qs('#lb-arc-name').value.trim() || 'Player'; saveLB('arc', name, state.score); renderLB('arc'); updateQuick(); });
    })();

    /* Save binds for leaderboards from main UI */
    qs('#lb-slots-save')?.addEventListener('click', ()=>{ const name=qs('#lb-slots-name').value.trim()||'Player'; saveLB('slots', name, Number(qs('#slotsBal').textContent)); renderLB('slots'); updateQuick(); });
    qs('#lb-math-save')?.addEventListener('click', ()=>{ const name=qs('#lb-math-name').value.trim()||'Player'; saveLB('math', name, Number(qs('#mathScore').textContent)); renderLB('math'); updateQuick(); });
    qs('#lb-type-save')?.addEventListener('click', ()=>{ const name=qs('#lb-type-name').value.trim()||'Player'; saveLB('type', name, Number(qs('#typeWpm').textContent)); renderLB('type'); updateQuick(); });
    qs('#lb-bj-save')?.addEventListener('click', ()=>{ const name=qs('#lb-bj-name').value.trim()||'Player'; saveLB('bj', name, Number(qs('#bjBank').textContent)); renderLB('bj'); updateQuick(); });

    /* Clear data */
    qs('#clearAll').addEventListener('click', ()=>{
      if(confirm('Clear all saved data? This will reset scores and leaderboards on this device.')){
        ['slots_bal','slots_bet','slots_best','bj_bank','bj_bet','bj_best','math_best','type_best','bb_best'].forEach(k=>localStorage.removeItem(k));
        ['lb_slots','lb_bj','lb_math','lb_type','lb_arc'].forEach(k=>localStorage.removeItem(k));
        location.reload();
      }
    });

    // mount leaderboards initially
    ['slots','bj','math','type','arc'].forEach(renderLB);
    updateQuick();
  </script>
</body>
</html>
